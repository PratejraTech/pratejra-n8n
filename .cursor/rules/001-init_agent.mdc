---
alwaysApply: true
---
---
name: Init Agent Behavior
version: "1.0.0"
alwaysApply: true
globs:
  - "**/*"
tags: ["agent","header","context-capture"]
---

## Purpose  
Ensure the “Agent” behaviour is constrained: it should only ingest context, store snapshots under `.agents/`, and **only** add a header docstring to files it touches on the rest of the tree. No other modifications allowed.

## RULES  
1. On file creation or modification:  
   - Save a snapshot into `.agents/contexts/<timestamp>/<relative-path>` preserving directory structure.  
   - If the file is touched, ensure a header docstring is present at the very top.  
2. When modifying existing files:  
   - **Only** add or update the header docstring. Do **not** change logic, JSON schema content, config settings, documentation body, or structure.  
3. For new files created by the Agent:  
   - Place them under `.agents/` or a designated area as context storage.  
   - Follow naming conventions for that directory (namespace by timestamp/domain).  
4. Idempotency:  
   - Re-running the Agent must not create duplicate snapshots for unchanged files.  
   - If header already exists and is correct, no change is needed.  
5. Logging:  
   - Agent must append a log entry in `.agents/logs/agent‐actions.log` for each snapshot or header change: timestamp, file-path, action.

## Enforcement  
The Agent should self-check:  
- If it attempts any modification beyond header insertion or snapshot creation → reject.  
- If file touched is outside allowed domains → flag and request user confirmation.

## Examples  
- ✅ Correct: Create `workflows/domain_crm/lead_intake.json`, then snapshot to `.agents/contexts/2025-11-19/workflows/domain_crm/lead_intake.json`, add header at top of JSON.  
- ❌ Incorrect: Changing “steps” array inside `lead_intake.json` to add new logic → prohibited unless user explicitly requests a new file version.

